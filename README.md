# Αυτόματη λήψη οριστικοποιημένων Ε7 από Εργάνη

## Προετοιμασία

Το πρόγραμμα λειτουργεί παράλληλα με μια εγκατάσταση browserless/chrome για να
μπορεί να εμφανίζει ιστοσελίδες και να εκτελεί τις κινήσεις μέσω του puppeteer.

### Εγκατάσταση browserless/chrome

Αρκεί να τρέξουμε την παρακάτω εντολή σε ένα τερματικό:

```
docker run -e "CONNECTION_TIMEOUT=-1" -e "WORKSPACE_DIR=/home/blessuser/Downloads" -p 3000:3000 -v ./files:/home/blessuser/Downloads --restart always -d --name browserless browserless/chrome
```

Η μεταβλητή περιβάλλοντος CONNECTION_TIMEOUT ορίζει τον χρόνο εκτέλεσης του κάθε
script σε millisecond. Δίνοντας την τιμή -1 λέμε ότι δεν θέλουμε να γίνεται
τερματισμός μετά από κάποιο χρόνο (χρήσιμο ειδικά για λειτουργίες που απαιτούν
πολύ χρόνο). Προσοχή μόνο στον αριθμό των ταυτόχρονων συνδέσεων γιατί κάθε
μία θα δεσμεύει πόρους από το μηχάνημα.

### Εγκατάσταση βιβλιοθηκών

Για τις απαραίτητες βιβλιοθήκες αρκεί να τρέξουμε

```
npm ci
```

### Μεταγλώττιση typescript

Για την μεταγλώττιση της typescript σε javascript αρκεί να τρέξουμε

```
npm run compile
```

ή αν θέλουμε να γίνεται αυτόματα μεταγλώττιση καθώς κάνουμε αλλαγές

```
npm run watch
```

### Αρχείο ρυθμίσεων

Θα πρέπει να δημιουργηθεί ένα αρχείο .env που θα περιέχει τους κωδικούς για την
πρόσβαση στο σύστημα. Αυτό μπορεί να γίνει αντιγράφοντας το παράδειγμα και
συμπληρώνοντας τα αντίστοιχα πεδία.

```
cp .env.example .env
```

Τα πεδία FROM και TO είναι τα όρια των ημερομηνιών κατά την αναζήτηση των
αναγγελιών χωρίς διαχωριστικό μεταξύ ημέρας μήνα και έτους. Προσοχή να
συμπληρωθεί με δύο ψηφία για την ημέρα, δύο για τον μήνα και τέσσερα για το
έτος.

## Εκτέλεση

Αρκεί να εκτελέσουμε στο τερματικό

```
npm run start
```

Το πρόγραμμα εκτελείται και εμφανίζει στην κονσόλα μηνύματα για τις κινήσεις που
εκτελεί. Στον φάκελο files αποθηκεύονται τα αρχεία που κατεβάζει. Επίσης στο
αρχείο `down.log` αποθηκεύει την έξοδο των μηνυμάτων που βλέπουμε και στο
τερματικό αν χρειαστεί να ανατρέξουμε σε αυτό αργότερα.
